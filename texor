#!/bin/bash

# Verificar que el archivo fue proporcionado
if [ -z "$1" ]; then
    echo "Uso: $0 <archivo>"
    exit 1
fi

# Verificar que el archivo existe
if [ ! -f "$1" ]; then
    echo "El archivo '$1' no existe."
    exit 1
fi

# Mostrar el archivo con hexcurse en modo hexadecimal
hexcurse "$1" &

# PID del proceso hexcurse para poder cerrarlo más tarde
HEXCURSE_PID=$!

# Crear una interfaz de usuario sencilla para manejar las opciones
while true; do
    echo "Presiona Ctrl + T para cambiar a modo binario."
    echo "Presiona Ctrl + E para editar el archivo."
    read -rsn1 input
    if [ "$input" = $'\x14' ]; then  # Ctrl + T es \x14 en código ASCII
        pkill -f hexcurse  # Cierra hexcurse
        echo "Cambiando a modo binario..."
        xxd -b "$1"  # Muestra el archivo en binario
    elif [ "$input" = $'\x05' ]; then  # Ctrl + E es \x05 en código ASCII
        pkill -f hexcurse  # Cierra hexcurse
        echo "Abriendo editor hexadecimal..."
        hexedit "$1"  # Abre el archivo en hexedit para edición
        # Volver a mostrar el archivo con hexcurse después de la edición
        hexcurse "$1" &
        HEXCURSE_PID=$!
    fi
done
